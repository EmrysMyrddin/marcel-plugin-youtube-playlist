<dom-module id="marcel-plugin-youtube-playlist">
  <template>
    <div id="player"></div>
  </template>

  <script>
    (() => {
      class YoutubePlaylist extends Polymer.Element {
        static get is() { return 'marcel-plugin-youtube-playlist' }
        static get properties() {
          return {
            playlist: String,
          }
        }

        connectedCallback() {
          super.connectedCallback();

          this.initYoutubeAPI()
        }

        onYouTubeIframeAPIReady() {
          console.log("Creating youtube player")
          this.player = new YT.Player(this.$.player, {
            playerVars: {
              list: "PLyXfMx6QXEe_7vnNEhifiKAtyP9e-x-8f",
              listType: "playlist",
              autoplay: 1,
              controls: 0,
              loop: 1,
              showinfo: 0,
              fs: 0,
            },
            height: '100%',
            width: '100%',
            events: {
              onError: console.error
            }
          });
        }

        initYoutubeAPI() {
          if (window.YT) return this.onYouTubeIframeAPIReady()

          const id = "youtube-iframe-js", s = "script", src = "https://www.youtube.com/iframe_api"

          const fjs = document.getElementsByTagName(s)[0]
          const js = document.createElement(s)

          js.id = id
          js.src = src
          fjs.parentNode.insertBefore(js, fjs)

          window.onYouTubeIframeAPIReady = this.onYouTubeIframeAPIReady.bind(this)
        }
      }

      customElements.define(YoutubePlaylist.is, YoutubePlaylist);
    })();
  </script>
</dom-module>